name: Bump version tag and release zipped .exe

on:
  push:
    branches:
      - automatic-releases-and-semver

jobs:
  bump_version_tag:
    name: Bump version and push tag
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: '0'
    - name: Execute action anothrNick/github-tag-action
      uses: anothrNick/github-tag-action@1.26.0
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        WITH_V: true
        DEFAULT_BUMP: patch
  create_and_publish_release:
    needs: bump_version_tag
    runs-on: ubuntu-latest
    name: create-executable
    steps:
    - uses: actions/checkout@master
    - name: Create exectuable
      run: dotnet publish -c Release -r win-x64 -p:PublishReadyToRun=false -p:PublishSingleFile=true --self-contained true
    - name: Copy README
      run: cp D:\a\Blue10CLI\Blue10CLI\README.md D:\a\Blue10CLI\Blue10CLI\Blue10CLI\bin\Release\net5.0\win-x64\publish
    - name: Create archive
      uses: thedoctor0/zip-release@master
      with:
        directory: 'D:\a\Blue10CLI\Blue10CLI\Blue10CLI\bin\Release\net5.0\win-x64\publish'
        filename: 'release.zip'
        type: 'zip'
    - name: Upload archive as release
      uses: ncipollo/release-action@v1
      with:
        artifacts: 'D:\a\Blue10CLI\Blue10CLI\Blue10CLI\bin\Release\net5.0\win-x64\publish\release.zip'
        token: ${{ secrets.GITHUB_TOKEN }}